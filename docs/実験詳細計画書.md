# MobileNLD-FL 実験詳細計画書

## 実験概要

被験者1名のデータを用いて、スマートフォン上での非線形歩行動力学解析と個人化連合オートエンコーダによる疲労異常検知の有効性を実証する。

## 実験装置

### メインデバイス
- **iPhone 13**
  - プロセッサ: A15 Bionic
  - OS: iOS 17
  - 内蔵IMU: 100Hz サンプリング
  - 背面カメラPPG: 30Hz（指で覆って心拍計測）

### オプションデバイス
- **Polar H10**（借用可能な場合）
  - 心拍センサーとして使用
  - より正確なHRV計測が可能

## データ取得プロトコル

### 実験設計
- **被験者**: 著者1名（健常成人）
- **総時間**: 100分（10分×10セッション）
- **場所**: 屋内平坦路（廊下等）

### セッション構成

| セッション | 条件 | RPE | 詳細 |
|-----------|------|-----|------|
| S1-S3 | 快適歩行 | 6-8 | 通常の快適な速度で歩行 |
| S4-S6 | 速歩 | ≈11 | やや速い速度で歩行 |
| S7-S8 | 疲労歩行1 | >15 | スクワット15分直後の歩行 |
| S9-S10 | 疲労歩行2 | >15 | 階段昇降10分直後の歩行 |

### 測定項目
- **各セッション終了後**: Borg RPE（主観的運動強度）を記録
- **連続計測**: IMUデータ、心拍データ

## 特徴抽出: Mobile-NLD-mini

### 実装言語
Swift with Accelerate Framework

### 処理仕様
- **窓サイズ**: 3秒スライディング窓（1秒ホップ）
- **固定小数点**: q15形式

### 非線形動力学指標

#### 1. リアプノフ指数（LyE）
- **手法**: Rosenstein法
- **パラメータ**: 
  - 埋め込み次元 m = 5
  - 遅れ時間 τ = 4
  - 固定小数点 q15

#### 2. Detrended Fluctuation Analysis（DFA）
- **窓長**: {8, 16, 32, 64, 128, 256}サンプル
- **出力**: スケーリング指数α

#### 3. 心拍変動（HRV）
- **時間領域**: RMSSD（連続するRR間隔の差の二乗平均平方根）
- **周波数領域**: LF/HF比（Welch法、256ポイント）

### 性能目標
- **処理時間**: 4ms/窓
- **消費電力**: Energy Log増分 +23mA（5分連続実行時）

## 連合学習シミュレーション

### 実験設定
- **クライアント数**: 10（各セッション = 1クライアント）
- **データ分布**: 非IID（運動強度の差による）

### 入力特徴量（10次元）
1. NLD特徴（2次元）: LyE, DFA α
2. HRV特徴（2次元）: RMSSD, LF/HF
3. 基本統計（6次元）: 平均、標準偏差、RMS、最大値、最小値、レンジ

### モデルアーキテクチャ

#### 標準連合オートエンコーダ（FedAvg-AE）
- Encoder: 10 → 32 → 16
- Decoder: 16 → 32 → 10
- 全パラメータを集約

#### 個人化連合オートエンコーダ（PFL-AE）
- **共有Encoder**: 10 → 32 → 16（サーバで集約）
- **ローカルDecoder**: 16 → 32 → 10（各クライアントで保持）

### 学習設定
- **ラウンド数**: 20
- **ローカルエポック**: 1
- **バッチサイズ**: 256
- **学習率**: 1e-3

### 評価方法
- **異常クラス**: S7-S10（疲労歩行）
- **正常クラス**: S1-S6（快適・速歩）
- **評価指標**: ROC-AUC

## 期待される結果

### 1. 計算精度
- LyE RMSE: 0.021（MATLAB基準）
- DFA RMSE: 0.018（MATLAB基準）

### 2. 処理性能
- Python → Swift-q15で22倍高速化

### 3. 疲労異常検知性能
- 統計特徴＋FedAvg-AE: AUC 0.71
- 統計＋NLD/HRV＋FedAvg-AE: AUC 0.75（+0.04）
- 統計＋NLD/HRV＋PFL-AE: AUC 0.84（+0.13）

### 4. 通信効率
- PFL-AEの通信量: FedAvgの0.62倍

## データ管理

### 保存形式
- **生データ**: CSV形式（タイムスタンプ付き）
- **特徴量**: CSV形式（窓ごと）
- **モデル**: TensorFlow SavedModel形式

### 公開方針
- 論文採択後、GitHubで全データ・コードを公開
- MITライセンスでの提供

## 倫理的配慮

- 被験者は著者本人（インフォームドコンセント不要）
- 個人を特定できる情報は含まない
- 公開データセット（MHEALTH）も併用

## リスク管理

### 技術的リスク
- **iPhone計測精度**: 事前にPolar H10等と比較検証
- **処理落ち**: バッファリング実装で対応

### 実験リスク
- **疲労プロトコル**: 過度な負荷を避け、適切な休憩を設定
- **データ損失**: リアルタイムバックアップ実装

## スケジュール詳細

### Day 1-2: 基盤実装
- MHEALTH前処理完了
- iOS基本実装完了

### Day 3: 実機実験
- 午前: キャリブレーション
- 午後: 本実験（100分）
- 夕方: データ整理

### Day 4-5: ML実装・評価
- 連合学習実装
- 性能評価

### Day 6-7: 論文執筆
- 図表作成
- 本文執筆
- 投稿準備