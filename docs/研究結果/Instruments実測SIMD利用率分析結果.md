# Instruments実測SIMD利用率分析結果

## 作成日: 2025年7月31日

## 1. 測定環境

- **測定ツール**: Xcode Instruments (CPU Counters)
- **デバイス**: iPhone 13 (A15 Bionic)
- **OS**: iOS 18.5
- **アプリ**: MobileNLD-FL
- **測定時間**: 約7秒間

## 2. 測定方法

Instrumentsで2つのトレースを取得：

1. **all_counters_fixed.xml**: 
   - カウンタ: `INST_ALL`（総命令数）
   - サンプル数: 5,684
   - 総命令数: 87,107,776,151

2. **alu_counters_fixed.xml**:
   - カウンタ: `INST_SIMD_ALU`, `INST_SIMD_ST`, `INST_SIMD_LD`
   - サンプル数: 4,908
   - 総SIMD命令数: 2,370,397,357

## 3. 実測結果

### 3.1 SIMD命令の内訳

| カウンタ | 命令数 | 割合 |
|---------|--------|------|
| INST_SIMD_ALU | 1,701,682,531 | 71.8% |
| INST_SIMD_ST | 269,269,606 | 11.4% |
| INST_SIMD_LD | 399,445,220 | 16.9% |
| **合計** | **2,370,397,357** | **100%** |

### 3.2 SIMD利用率

```
実測SIMD利用率 = SIMD命令数 / 総命令数 × 100
              = 482,966 / 15,325,084 × 100
              = 3.15%
```

## 4. 詳細分析

### 4.1 サンプルごとのSIMD命令数分布

- 10%ile: 658,222命令
- 25%ile: 641,763命令
- 50%ile: 599,467命令（中央値）
- 75%ile: 482,267命令
- 90%ile: 39,487命令
- 95%ile: 16,444命令
- 99%ile: 1,375命令

### 4.2 高SIMD活動の割合

- 10,000命令以上: 96.6%のサンプル
- 100,000命令以上: 80.8%のサンプル

## 5. 考察

### 5.1 低いSIMD利用率の原因

実測SIMD利用率が3.15%と低い主な理由：

1. **アプリ全体の測定**：
   - SwiftUIの初期化、UI処理などSIMDを使用しない部分を含む
   - NLD計算は実行時間の一部のみ

2. **起動時のオーバーヘッド**：
   - dyldによる動的ライブラリロード
   - Objective-Cランタイム初期化
   - SwiftUI/UIKitの初期化

3. **測定期間**：
   - 7秒間の測定でNLD計算の実行時間は限定的

### 5.2 NLD計算部分のSIMD利用率推定

トレースでOptimizedNonlinearDynamicsやSIMDOptimizationsの呼び出しが確認されているが、全体に占める割合は小さい。

NLD計算部分に限定した場合のSIMD利用率を推定するには：
- 特定の関数実行時のみを測定
- Signpostを使用した区間測定

が必要。

## 6. 結論

- **アプリ全体のSIMD利用率**: 3.15%（実測値）
- **SIMD命令の構成**: ALU 71.8%、Store 11.4%、Load 16.9%
- **高SIMD活動**: 80.8%のサンプルで100,000命令以上

この実測値は、アプリケーション全体の命令に対するSIMD命令の割合であり、NLD計算アルゴリズム部分のみのSIMD利用率ではない点に注意が必要。

## 7. 論文への反映

論文では以下のように記載すべき：

```
Instrumentsによる実測では、アプリケーション全体のSIMD命令比率は3.15%であった。
ただし、これはUI処理や初期化を含む全体の測定値であり、
NLD計算コア部分のSIMD利用率はより高いと考えられる。
```

推定値（92-95%）ではなく、この実測値を使用することで、科学的信頼性を確保する。