# Signpost実測SIMD利用率分析結果

## 作成日: 2025年7月31日

## 1. 測定環境

- **測定ツール**: Xcode Instruments (CPU Counters + Signpost)
- **デバイス**: iPhone 13 (A15 Bionic)
- **OS**: iOS 18.5
- **アプリ**: MobileNLD-FL
- **測定方法**: os_signpostによる区間測定

## 2. 測定結果

### 2.1 Lyapunov指数計算

| カウンタ | 値 |
|---------|-----|
| INST_ALL（総命令数） | 4,506,994,215 |
| INST_SIMD_ALU | 46,109,363 |
| INST_SIMD_ST | 30,372,014 |
| INST_SIMD_LD | 30,338,273 |
| **総SIMD命令数** | **106,819,650** |

**SIMD利用率**: 106,819,650 / 4,506,994,215 × 100 = **2.37%**

実行時間: 266-290ms

### 2.2 DFA計算

| カウンタ | 値 |
|---------|-----|
| INST_ALL（総命令数） | 67,225,183 |
| INST_SIMD_ALU | 1,368,978 |
| INST_SIMD_ST | 560,378 |
| INST_SIMD_LD | 425,273 |
| **総SIMD命令数** | **2,354,629** |

**SIMD利用率**: 2,354,629 / 67,225,183 × 100 = **3.50%**

実行時間: 約4ms

### 2.3 統合計算（Lyapunov + DFA）

| カウンタ | 値 |
|---------|-----|
| INST_ALL（総命令数） | 4,573,539,148 |
| INST_SIMD_ALU | 47,382,450 |
| INST_SIMD_ST | 30,803,714 |
| INST_SIMD_LD | 30,614,053 |
| **総SIMD命令数** | **108,800,217** |

**SIMD利用率**: 108,800,217 / 4,573,539,148 × 100 = **2.38%**

実行時間: 約266ms

## 3. SIMD命令の内訳分析

### Lyapunov指数
- ALU: 43.2%
- Store: 28.4%
- Load: 28.4%

### DFA
- ALU: 58.1%
- Store: 23.8%
- Load: 18.1%

### 統合計算
- ALU: 43.5%
- Store: 28.3%
- Load: 28.1%

## 4. 性能指標

### 命令実行率
- Lyapunov: 16.9億命令/秒（4.51B命令 / 266ms）
- DFA: 16.8億命令/秒（67.2M命令 / 4ms）
- 統合: 17.2億命令/秒（4.57B命令 / 266ms）

### SIMD命令実行率
- Lyapunov: 4.01億SIMD命令/秒
- DFA: 5.89億SIMD命令/秒
- 統合: 4.09億SIMD命令/秒

## 5. 分析と考察

### 5.1 低いSIMD利用率の要因

1. **アルゴリズムの特性**
   - 最近傍探索での条件分岐
   - データ依存性による逐次処理
   - 小さなウィンドウサイズ（150サンプル）

2. **Swift/Objective-Cオーバーヘッド**
   - 関数呼び出しのオーバーヘッド
   - メモリ管理（ARC）
   - 型変換処理

3. **vDSPライブラリの利用パターン**
   - 小規模データでのライブラリ呼び出しオーバーヘッド
   - SIMD命令の前後の準備・後処理

### 5.2 改善の可能性

1. **バッチ処理の拡大**
   - より大きなデータブロックでの処理
   - 複数ウィンドウの並列処理

2. **アルゴリズムの最適化**
   - 条件分岐の削減
   - データレイアウトの最適化

3. **低レベル実装**
   - C++やアセンブリでのコア部分実装
   - Metal Performance Shadersの活用

## 6. 結論

**NLD計算アルゴリズム部分の実測SIMD利用率**：
- Lyapunov指数: **2.37%**
- DFA: **3.50%**
- 統合計算: **2.38%**

これらは実測値であり、推定値ではない。アプリ全体（3.15%）と比較して、NLD計算部分に限定しても利用率は同程度であることが判明した。

## 7. 論文への反映

```
Signpostによる区間測定の結果、Lyapunov指数計算で2.37%、
DFA計算で3.50%のSIMD命令比率が観測された。
これは、アルゴリズムの逐次的性質と小規模データサイズに起因する。
```