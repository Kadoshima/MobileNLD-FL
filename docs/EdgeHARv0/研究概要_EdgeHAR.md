# エッジ協調型適応的動作認識システム研究概要

## 研究タイトル
**Battery-Aware Dynamic Offloading for Multi-Edge HAR over BLE with Hierarchical Gating**
（バッテリー意識型動的オフロードによる複数エッジデバイス協調HAR）

## 1. 研究背景と目的

### 背景
- IoTデバイスの普及により、エッジコンピューティングの重要性が増大
- 従来のHARシステムは単一デバイスまたはクラウド依存
- バッテリー制約と計算資源の限界が課題

### 目的
- 複数エッジデバイス（M5Stack×3）の協調による効率的なHAR実現
- バッテリー意識型動的負荷分散により**mJ/判定を40-60%削減**
- BLE実運用下でのリアルタイム性（**p99レイテンシ<100ms**）の維持
- 階層ゲーティング（2クラス→8クラス）による省電力化

## 2. 提案手法

### システムアーキテクチャ
```
[M5Stack_1] → センサーデータ取得・前処理
     ↓
[M5Stack_2] → 軽量推論（2クラス：動作/静止）
     ↓
[M5Stack_3] → 詳細推論（8クラス動作分類）
     ↓
[iPhone]    → 統合制御・最適化
```

### 新規性（レビューで刺さるポイント）
1. **バッテリー意識型動的オフロード**
   - 複数マイコン間でのバッテリー指標駆動の負荷分散
   - 電算vs通信のトレードオフを実機で最適化
   - 1-2秒周期での再割当（ヒステリシス付き）

2. **階層ゲーティング推論**
   - 2クラス軽量ゲート→8クラス詳細分類の2段階構成
   - mJ/判定の大幅削減（常時8クラス比）
   - 活動パターンに応じた動的切替

3. **BLE実運用の制約下での最適化**
   - ATT_MTU（実測185B）と接続間隔（15-20ms）を考慮
   - 特徴量のみ送信で通信量削減
   - iOS/M5Stack間の現実的なBLE最適化

### 理論的基盤

**消費電力モデル**:
総消費電力は計算電力と通信電力の和として定式化：

$$P_{total} = P_{comp} + P_{comm} = \sum_{i=1}^{n} (c_i \cdot t_i) + \sum_{j=1}^{m} (d_j \cdot r_j)$$

ここで：
- $P_{comp}$: 計算による消費電力
- $P_{comm}$: 通信による消費電力  
- $c_i$: タスク$i$の計算コスト係数
- $t_i$: タスク$i$の実行時間
- $d_j$: デバイス$j$間の通信コスト
- $r_j$: デバイス$j$のデータ転送量

**負荷分散の最適化問題**:
$$\min_{x_{ij}} \sum_{i,j} P_{ij} \cdot x_{ij}$$
$$\text{subject to: } \sum_{j} x_{ij} = 1, \quad B_j \geq B_{min}$$

ここで$x_{ij}$はタスク$i$をデバイス$j$に割り当てる2値変数、$B_j$はデバイス$j$のバッテリー残量。

## 3. 技術仕様

### ハードウェア構成
- **M5Stack Core2 × 3台**
  - ESP32 (Dual-core 240MHz)
  - 520KB SRAM, 16MB Flash
  - 6軸IMU (MPU6886)
  - BLE 5.0対応

- **iPhone (統合制御)**
  - Core ML / TensorFlow Lite
  - SwiftUIによるリアルタイム可視化

### ソフトウェアスタック
- **エッジデバイス側**
  - Arduino IDE + PlatformIO
  - TensorFlow Lite Micro
  - FreeRTOS

- **iPhone側**
  - Swift 5.0+
  - Core Bluetooth
  - Core ML

### 機械学習モデル
- **軽量モデル（2クラス）**
  - サイズ: <20KB
  - 推論時間: <10ms
  - 精度: 95%

- **詳細モデル（8クラス）**
  - サイズ: <50KB
  - 推論時間: <30ms
  - 精度: 92%

## 4. 実験計画

### データセット
1. **独自データ収集**（メイン）
   - **M5Stack装着で3-5人 × 8動作 × 各100サンプル**
   - センサー位置・装着方法を統一
   - 実デバイスでの現実的な評価

2. **UCI HAR Dataset**（ベースラインのみ）
   - 再学習用の参照データ
   - センサー・装着位置依存のため補助的使用

### 評価指標（優先度順）
1. **エネルギー効率（主要指標）**
   - **mJ/判定**（消費電流×電圧×時間/判定回数）
   - 3台総和と最小バッテリー端末単体の両方
   - USB電流計による実測

2. **レイテンシ**
   - **p50/p99レイテンシ**（平均値ではなく分布）
   - End-to-end処理時間（センサー→結果表示）
   - BLE通信遅延の内訳

3. **精度**
   - Accuracy/F1-score（8クラス分類）
   - 階層ゲーティングの効果測定

4. **補助指標**
   - バッテリー寿命倍率（1.5-2倍目標）
   - 通信量/秒（BLE制約の確認）

### 比較対象（実験最小セット）
1. **提案手法**（動的負荷分散＋階層ゲーティング）
2. **静的割当**（固定的タスク配置）
3. **スマホ単独**（iPhone上で全処理）
4. **M5Stack単独**（単一デバイスで全処理）

### BLE実測パラメータ（表で明記）
- **ATT_MTU**: 185バイト（iOS実測値）
- **接続間隔**: 15-20ms（最小設定時）
- **通知サイズ**: 特徴量のみ（20-50バイト）
- **サンプリング**: 50Hz（窓幅2秒）

## 5. 期待される成果

### 定量的目標
- **mJ/判定**: 40-60%削減（vs 単一デバイス）
- **p99レイテンシ**: <100ms（BLE制約下）
- **精度（8クラス）**: 85-92%維持
- **バッテリー寿命**: 1.5-2倍延長

### 実験条件
- **測定時間**: 連続5分×3回
- **アブレーション**: 
  - 動的割当 ON/OFF
  - 階層ゲーティング ON/OFF

### 学術的貢献
- エッジデバイス協調型HARの実現可能性実証
- 動的負荷分散アルゴリズムの提案
- 省電力と精度のトレードオフ最適化

## 6. 論文投稿計画

### ターゲット
- **IEICE Communications Express (ComEX)**
- 4ページ上限（月刊、随時投稿可能）
- **投稿目標: 2025年9月**
- 想定採択率: 40-60%（ComEX公表値46-56%＋テーマ適合性）

### 論文構成（4ページ制約）
1. Introduction (0.5ページ)
   - Battery-aware, multi-edge, hierarchical gating, <100msを強調
2. Related Work (0.3ページ)
   - 3系統×各1本に厳選（TinyML HAR、省電力HAR、階層推論）
3. Proposed Method (1.2ページ)
   - アーキテクチャ、アルゴリズム、BLE最適化
4. Experiments (1.5ページ)
   - **図1**: エネルギー-精度-レイテンシのPareto曲線
   - **表1**: BLE通信パラメータと測定条件
   - アブレーション結果（2本）
5. Conclusion (0.5ページ)

### 必要な図表（最小限）
- **図1枚**: Pareto曲線（mJ/判定 vs 精度 vs レイテンシ）
- **表1枚**: 実験条件（BLE実測値含む）
- **アブレーション**: 文章中に埋め込み

## 7. リスク管理

### 技術的リスク
- **メモリ制約**: TFLite Microで対応
- **通信遅延**: 特徴量のみ送信で軽減
- **同期問題**: タイムスタンプベース同期

### スケジュールリスク
- Week1の遅延は致命的 → 並列作業で対応
- 実験データ不足 → UCI HARで補完

## 8. 研究の意義

### 社会的インパクト
- Society 5.0実現への貢献
- 高齢者見守りシステムへの応用
- スマートシティでの活用

### 技術的インパクト
- エッジAIの新たな実装パラダイム
- 分散処理による省電力化手法
- リアルタイムHARの実用化

## 8. 参考文献（最小限3本）

1. **TinyML/エッジHAR**: Zhou et al., "Efficient human activity recognition on edge devices", Sci. Rep., 2025
2. **省電力HAR総説**: Contoli et al., "Energy-aware human activity recognition", Pervasive Mobile Comput., 2024
3. **階層推論**: Dentamaro et al., "Human activity recognition with smartphone", Expert Syst. Appl., 2024

---
*Last Updated: 2024-12-10*
*Target: IEICE ComEX (September 2025)*
*Status: Active Research Project*